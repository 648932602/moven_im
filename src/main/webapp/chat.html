<!DOCTYPE html>
<html>
<head>
<meta http-equiv="content-type" content="txt/html; charset=utf-8" />
<title>Testing websockets</title>
</head>
<body>
	<div>
		发信人：<input type="text" id="username"/><br/>
		收信人：<input type="text" id="receivername"/><br/>
		<textarea name="text" id="text" rows="3" cols="30"></textarea><br/>
		<input type="button" value="open" onclick="openConnect()" />
		<input type="submit" value="send" onclick="start()" />
		<input type="button" value="close" onclick="closeConnect()" />
	</div>
	<div id="messages"></div>
	<script type="text/javascript">
		var webSocket;
		function onMessage(event) {
			document.getElementById('messages').innerHTML += '<br />' + event.data;
		}
		function onOpen(event) {
			document.getElementById('messages').innerHTML = 'Connection established';
		}
		function onClose(event) {
			document.getElementById('messages').innerHTML = 'Connection closed';
		}
		function onError(event) {
			alert(event.data);
		}

		function openConnect() {
			var username = document.getElementById('username').value;
			var receivername = document.getElementById('receivername').value;
			var URL = 'ws://local.moven.cn:8081/moven_im/chat/'+username+'/'+receivername;
			if(webSocket){
				webSocket.close();
			}
			webSocket = new WebSocket(URL);
			webSocket.onerror = function(event) {
				onError(event)
			};
			webSocket.onopen = function(event) {
				onOpen(event)
			};
			webSocket.onclose = function(event) {
				onClose(event)
			};
			webSocket.onmessage = function(event) {
				onMessage(event)
			};
			return false;
		}
		
		function start() {
			var text = document.getElementById('text').value;
			if(webSocket){
				if(text){
					webSocket.send(text);
					document.getElementById('text').value = '';
				} else {
					alert("Message can't be null");
				}
			} else {
				alert("WebSocket not connected");
			}
			return false;
		}
		
		function closeConnect() {
			if(webSocket){
				webSocket.close();
			}
			return false;
		}
	</script>
</body>
</html>